# ระบบจองที่จอดรถอัจฉริยะ - Arduino Firmware

โค้ด Arduino สำหรับระบบจองที่จอดรถอัจฉริยะที่สามารถส่งข้อมูลไปยังเว็บไซต์แบบเรียลไทม์

## ไฟล์โค้ด

### ไฟล์เดิม (ไม่เชื่อมต่อเว็บ)
- `BoardA_parking_sensor.ino` - เซ็นเซอร์อาคาร A (เดิม)
- `BoardB_parking_sensor.ino` - เซ็นเซอร์อาคาร B (เดิม)
- `auto_gate_control.ino` - ระบบควบคุมประตูอัตโนมัติ

### ไฟล์ใหม่ (เชื่อมต่อเว็บ)
- `BoardA_parking_sensor_web.ino` - เซ็นเซอร์อาคาร A พร้อมส่งข้อมูลไปเว็บ
- `BoardB_parking_sensor_web.ino` - เซ็นเซอร์อาคาร B พร้อมส่งข้อมูลไปเว็บ

## การติดตั้ง

### 1. ไลบรารีที่จำเป็น
ติดตั้งไลบรารีต่อไปนี้ใน Arduino IDE:
- `ArduinoJson` (เวอร์ชัน 6.x)
- `WiFi` (มีอยู่แล้วใน ESP32)

### 2. การตั้งค่า WiFi
แก้ไขข้อมูล WiFi ในโค้ด:
```cpp
const char* ssid = "YOUR_WIFI_SSID";
const char* password = "YOUR_WIFI_PASSWORD";
```

### 3. การตั้งค่าเซิร์ฟเวอร์
แก้ไข URL ของเซิร์ฟเวอร์:
```cpp
const char* serverURL = "http://192.168.1.100:3000/api/parking";
```
เปลี่ยน `192.168.1.100` เป็น IP address ของคอมพิวเตอร์ที่รันเว็บไซต์

## การเชื่อมต่อฮาร์ดแวร์

### Board A & B (Parking Sensors)
```
เซ็นเซอร์ IR:
- A1: Pin 32
- A2: Pin 33  
- A3: Pin 25
- A4: Pin 26

LED เขียว:
- A1: Pin 27
- A2: Pin 14
- A3: Pin 12
- A4: Pin 13

LED แดง:
- A1: Pin 23
- A2: Pin 16 (Board A) / Pin 22 (Board B)
- A3: Pin 17 (Board A) / Pin 21 (Board B)
- A4: Pin 15
```

### Auto Gate Control
```
ทางเข้า:
- ปุ่ม: Pin 4
- Ultrasonic Trig: Pin 5
- Ultrasonic Echo: Pin 18
- Servo: Pin 19

ทางออก:
- Ultrasonic Trig: Pin 21
- Ultrasonic Echo: Pin 22
- Servo: Pin 23
```

## การทำงาน

### 1. การอ่านเซ็นเซอร์
- อ่านค่าเซ็นเซอร์ IR ทุก 200ms
- ถ้าเซ็นเซอร์อ่านค่า LOW = มีรถ (IR ถูกบัง)
- ถ้าเซ็นเซอร์อ่านค่า HIGH = ว่าง

### 2. การแสดงผล LED
- LED เขียว = ที่จอดว่าง
- LED แดง = ที่จอดถูกจอง

### 3. การส่งข้อมูล
- ส่งข้อมูลไปยังเว็บไซต์ทุก 2 วินาที
- ส่งข้อมูลทันทีเมื่อมีการเปลี่ยนแปลง
- ใช้ HTTP POST request ส่ง JSON

### 4. ข้อมูลที่ส่ง
```json
{
  "boardA": [false, false, true, false],
  "boardB": [true, false, false, true]
}
```

## การแก้ไขปัญหา

### 1. WiFi ไม่เชื่อมต่อ
- ตรวจสอบ SSID และ Password
- ตรวจสอบสัญญาณ WiFi
- ดู Serial Monitor สำหรับข้อผิดพลาด

### 2. เซิร์ฟเวอร์ไม่รับข้อมูล
- ตรวจสอบ IP address ของเซิร์ฟเวอร์
- ตรวจสอบว่าเว็บไซต์ทำงานอยู่
- ดู Serial Monitor สำหรับ HTTP response code

### 3. เซ็นเซอร์ไม่ทำงาน
- ตรวจสอบการเชื่อมต่อสายไฟ
- ตรวจสอบการตั้งค่า pin
- ทดสอบด้วย multimeter

### 4. LED ไม่ติด
- ตรวจสอบการเชื่อมต่อ
- ตรวจสอบการตั้งค่า pin
- ตรวจสอบแรงดันไฟ

## การปรับแต่ง

### 1. เปลี่ยนช่วงเวลาการส่งข้อมูล
```cpp
const unsigned long updateInterval = 2000; // เปลี่ยนเป็นมิลลิวินาที
```

### 2. เปลี่ยนช่วงเวลาการอ่านเซ็นเซอร์
```cpp
delay(200); // เปลี่ยนเป็นมิลลิวินาที
```

### 3. เพิ่มเซ็นเซอร์
- เพิ่ม pin ในอาร์เรย์ `irPins[]`
- เพิ่ม pin LED ในอาร์เรย์ `ledGreen[]` และ `ledRed[]`
- เพิ่มในลูป `for` ใน `setup()` และ `loop()`

## การทดสอบ

### 1. ทดสอบเซ็นเซอร์
- วางวัตถุขวางเซ็นเซอร์
- ตรวจสอบว่า LED เปลี่ยนสี
- ดู Serial Monitor ว่าข้อมูลถูกต้อง

### 2. ทดสอบการส่งข้อมูล
- เปิด Serial Monitor
- ดูข้อความ "Sending data to server"
- ตรวจสอบ HTTP response code

### 3. ทดสอบการเชื่อมต่อเว็บ
- เปิดเว็บไซต์
- ตรวจสอบว่าข้อมูลอัปเดตแบบเรียลไทม์
- ทดสอบการจองที่จอดรถ

## หมายเหตุ

- ใช้ ESP32 สำหรับการเชื่อมต่อ WiFi
- ต้องมีไลบรารี ArduinoJson
- ระบบทำงานแบบ real-time
- รองรับการขยายได้

## การสนับสนุน

หากมีปัญหาหรือคำถาม กรุณาติดต่อทีมพัฒนา


